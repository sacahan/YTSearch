# 功能規範：YouTube 搜尋 API

**功能分支**：`001-youtube-search-api`
**建立日期**：2025-12-06
**狀態**：草稿
**輸入**：使用者描述：使用 YouTube search URL 建立 API 功能，輸入關鍵字找出符合的影片，並提取出其中的 metadata（如 video_id），以便後續其他系統使用

**語言**：本文件及所有 `/speckit` 產出必須使用正體中文撰寫

## 用戶情景與測試 *(必須)*

### 用戶故事 1 - 基本搜尋功能（優先級：P1）

系統提供 API 端點接受關鍵字輸入，透過 YouTube 搜尋結果頁面取得符合的影片清單。

**為何此優先級**：這是核心功能，沒有它其他功能無法運作。系統能否從 YouTube 取得搜尋結果是整個功能的基礎。

**獨立測試**：可直接呼叫 API 端點傳入單一關鍵字（例如「Python 教學」），驗證是否返回含有影片資訊的 JSON 回應，並且至少包含 video_id 欄位。

**接受情景**：

1. **當** 客戶端呼叫 `GET /api/search?keyword=Python教學` **則** 系統返回 HTTP 200 且包含影片清單
2. **當** 清單中至少有一筆記錄 **則** 該記錄需包含 `video_id`、`title`、`url` 等基本 metadata
3. **當** 搜尋無結果 **則** 系統返回空清單，而非錯誤

---

### 用戶故事 2 - 元數據提取（優先級：P1）

API 從搜尋結果中提取並整理各影片的 metadata，包括 video_id、標題、描述、頻道、發佈日期等，以標準化格式返回。

**為何此優先級**：提取 metadata 是核心價值主張。無法有效提取 metadata 就無法滿足「供後續系統使用」的需求。

**獨立測試**：搜尋後檢查回應中的每筆影片記錄都包含預期的 metadata 欄位（video_id、title、channel、publish_date 等），且資料格式一致。

**接受情景**：

1. **當** 搜尋返回結果 **則** 每筆影片至少包含 `video_id`、`title`、`channel`、`url`
2. **當** metadata 有可用的發佈日期 **則** 應包含 `publish_date` 欄位
3. **當** metadata 有觀看計數 **則** 應包含 `view_count` 欄位（若可取得）

---

### 用戶故事 3 - 結果排序與過濾（優先級：P2）

API 支援根據相關性、發佈日期或觀看數對結果進行排序，允許客戶端指定返回的影片數量上限。

**為何此優先級**：提升結果品質與靈活性。P1 功能達成後，P2 優化搜尋體驗與效率。

**獨立測試**：傳入 `sort_by=relevance&limit=5` 參數，驗證是否返回最多 5 筆記錄且按相關性排序。

**接受情景**：

1. **當** 指定 `limit=5` **則** 返回最多 5 筆結果
2. **當** 指定 `sort_by=relevance` **則** 結果按相關性排序（預設行為）
3. **當** 指定 `sort_by=date` **則** 結果按發佈日期新舊排序

---

### 邊界情況

- 搜尋關鍵字為空或僅空白時如何處理？
- 搜尋關鍵字包含特殊字元或 Unicode 時是否正確編碼？
- YouTube 回應逾時或無法連接時系統如何回應？
- 同一關鍵字頻繁搜尋是否需要快取或速率限制？

## 需求 *(必須)*

### 功能性需求

- **FR-001**：系統必須透過公開可存取的 YouTube 搜尋 URL（`https://www.youtube.com/results?search_query={keyword}`）取得搜尋結果
- **FR-002**：系統必須從搜尋結果中正確提取 `video_id`
- **FR-003**：系統必須提供 RESTful API 端點接受關鍵字參數並返回 JSON 格式結果
- **FR-004**：系統必須為每筆影片至少提取 `video_id`、`title`、`channel`、`url` 等 metadata
- **FR-005**：系統必須驗證輸入關鍵字非空且長度合理（建議 1-200 字元）
- **FR-006**：系統必須記錄所有搜尋請求與錯誤到結構化日誌中
- **FR-007**：系統必須遵守 YouTube 服務條款，不下載或儲存媒體內容，僅提取 metadata

### 主要實體

- **搜尋結果（SearchResult）**：代表一次搜尋操作的結果集合
  - `search_keyword`：搜尋關鍵字
  - `result_count`：返回的影片數量
  - `videos`：影片清單（Video 實體的陣列）
  - `timestamp`：搜尋時間戳記

- **影片（Video）**：代表單個 YouTube 影片的 metadata
  - `video_id`：YouTube 影片唯一識別碼
  - `title`：影片標題
  - `url`：影片完整 URL
  - `channel`：頻道名稱
  - `channel_url`：頻道 URL
  - `publish_date`：發佈日期（若可用）
  - `view_count`：觀看次數（若可用）
  - `description`：影片描述摘要（若可用）

## 成功標準 *(必須)*

### 可測量的成果

- **SC-001**：API 在收到有效的關鍵字搜尋請求後，3 秒內返回結果（包括網路延遲）
- **SC-002**：搜尋結果中的 video_id 提取正確率達 95% 以上（可手動驗證前 10 筆結果對比 YouTube 頁面）
- **SC-003**：API 處理 100 個不同的測試關鍵字，至少 90% 無錯誤返回結果
- **SC-004**：metadata 欄位一致性達 100%（每筆結果都包含預期的必須欄位）
- **SC-005**：系統能正確處理特殊字元、Unicode、空格等邊界情況，不拋出未預期的異常
- **SC-006**：後續系統能直接使用返回的 video_id 識別或存取影片資訊

## 假設與限制

- 使用直接爬蟲 YouTube 搜尋頁面（而非官方 API）實現，因此可能受 HTML 結構變化影響
- 不使用官方 YouTube Data API，避免 API 配額限制但需承擔頁面結構變化風險
- POC 階段優先考慮功能可用性，而非大規模併發支援
- 搜尋結果排序基於 YouTube 頁面的預設順序（相關性）
